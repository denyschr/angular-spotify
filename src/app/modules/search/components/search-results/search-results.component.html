<ng-container *ngIf="vm$ | async as vm">
  <ng-container *ngIf="vm.type === sectionTypes.All && vm.allResults?.total; else filteredResults">
    <app-section
      *ngIf="vm.allResults?.results?.artists?.length"
      [sectionTitle]="'Artists'"
      [mediaItems]="vm.allResults!.results.artists"
    ></app-section>
    <app-section
      *ngIf="vm.allResults?.results?.albums?.length"
      [sectionTitle]="'Albums'"
      [mediaItems]="vm.allResults!.results.albums"
      [isAlbumDate]="true"
    ></app-section>
    <app-section
      *ngIf="vm.allResults?.results?.playlists?.length"
      [sectionTitle]="'Playlists'"
      [mediaItems]="vm.allResults!.results.playlists"
    ></app-section>
  </ng-container>
  <ng-template #filteredResults>
    <section class="section" *ngIf="vm.filteredResults.length; else noResults">
      <div class="section__items">
        <ng-container *ngFor="let filteredResult of vm.filteredResults; let i = index; trackById">
          <ng-container [ngSwitch]="filteredResult.type">
            <ng-container *ngSwitchCase="mediaTypes.Album">
              <app-album-card
                *ngIf="i + 1 === vm.filteredResults.length"
                [mediaItem]="filteredResult"
                [isAlbumDate]="true"
                (intersectionListener)="loadMore()"
                #lastItem
              ></app-album-card>
              <app-album-card
                *ngIf="i + 1 !== vm.filteredResults.length"
                [mediaItem]="filteredResult"
                [isAlbumDate]="true"
              ></app-album-card>
            </ng-container>
            <ng-container *ngSwitchCase="mediaTypes.Artist">
              <app-artist-card
                *ngIf="i + 1 === vm.filteredResults.length"
                [mediaItem]="filteredResult"
                (intersectionListener)="loadMore()"
                #lastItem
              ></app-artist-card>
              <app-artist-card
                *ngIf="i + 1 !== vm.filteredResults.length"
                [mediaItem]="filteredResult"
              ></app-artist-card>
            </ng-container>
            <ng-container *ngSwitchCase="mediaTypes.Playlist">
              <app-playlist-card
                *ngIf="i + 1 === vm.filteredResults.length"
                [mediaItem]="filteredResult"
                (intersectionListener)="loadMore()"
                #lastItem
              ></app-playlist-card>
              <app-playlist-card
                *ngIf="i + 1 !== vm.filteredResults.length"
                [mediaItem]="filteredResult"
              ></app-playlist-card>
            </ng-container>
          </ng-container>
        </ng-container>
      </div>
    </section>
  </ng-template>
  <ng-template #noResults>
    <app-no-results [query]="vm.term"></app-no-results>
  </ng-template>
</ng-container>
